<!DOCTYPE html>
<html>
<head>
    <title>宇宙成因核素综合分析工具</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            max-width: 800px;
        }
        .input-section, .result-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .input-group { 
            margin: 15px 0; 
        }
        label {
            display: inline-block;
            width: 180px;
            margin-right: 15px;
        }
        input { 
            width: 200px;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        button { 
            padding: 12px 30px;
            background-color: #2196F3;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 20px 0;
            font-size: 16px;
        }
        .result-block {
            padding: 15px;
            margin: 15px 0;
            background-color: #f8f9fa;
            border-radius: 6px;
        }
        .error { 
            color: #dc3545; 
            padding: 12px;
            background-color: #f8d7da;
            border-radius: 4px;
            margin: 15px 0;
        }
        h2 {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
    </style>
</head>
<body>
    <h2>宇宙成因核素综合分析系统</h2>

    <div class="input-section">
        <h3>基本参数</h3>
        <div class="input-group">
            <label for="latitude">地理纬度 (°):</label>
            <input type="number" id="latitude" min="-90" max="90" step="0.0001">
        </div>
        <div class="input-group">
            <label for="elevation">海拔高度 (m):</label>
            <input type="number" id="elevation" min="0" step="1">
        </div>
        <div class="input-group">
            <label for="depth">采样深度 (cm):</label>
            <input type="number" id="depth" min="0" step="0.1">
        </div>
        <div class="input-group">
            <label for="density">岩石密度 (g/cm³):</label>
            <input type="number" id="density" value="2.7" step="0.1">
        </div>
    </div>

    <div class="input-section">
        <h3>样品参数</h3>
        <div class="input-group">
            <label for="be10">¹⁰Be浓度 (atoms/g):</label>
            <input type="number" id="be10" step="1e5">
        </div>
        <div class="input-group">
            <label for="al26">²⁶Al浓度 (atoms/g):</label>
            <input type="number" id="al26" step="1e5">
        </div>
    </div>

    <button onclick="calculateAll()">开始计算</button>
    <div id="error" class="error" style="display: none;"></div>

    <div class="result-section" id="results" style="display: none;">
        <!-- 核素产率结果 -->
        <div class="result-block" id="production-results">
            <h3>核素产率计算结果</h3>
            <div id="production-details"></div>
        </div>

        <!-- 暴露年龄结果 -->
        <div class="result-block" id="age-results">
            <h3>暴露年龄计算结果</h3>
            <div id="age-details"></div>
        </div>

        <!-- 侵蚀速率结果 -->
        <div class="result-block" id="erosion-results">
            <h3>侵蚀速率计算结果</h3>
            <div id="erosion-details"></div>
        </div>
    </div>

<script>
// 核素物理参数库
const NUCLIDE_PARAMS = {
    '¹⁰Be': {
        P0: 6.0,       // 标称产率 (atoms/g/yr)
        lambda: 4.99e-7 // 衰变常数 (yr⁻¹)
    },
    '²⁶Al': {
        P0: 36.8,
        lambda: 9.83e-7
    },
    '¹⁴C': { P0: 20 },
    '³He': { P0: 124 },
    '²¹Ne': { P0: 21 },
    '³⁶Cl': { P0: 54 }
};

// 输入验证函数
function validateInput(id, constraints) {
    const input = document.getElementById(id);
    const value = parseFloat(input.value);
    
    // 基础验证
    if (isNaN(value)) {
        input.style.border = "2px solid #dc3545";
        return null;
    }
    
    // 范围验证
    if (constraints?.min !== undefined && value < constraints.min) return null;
    if (constraints?.max !== undefined && value > constraints.max) return null;
    
    input.style.border = "1px solid #ced4da";
    return value;
}

// 大气压力转换模型
function calculateAtmosphericPressure(elevation) {
    return 1013 * Math.pow(1 - elevation/44330, 5.255) * (1033/1013);
}

// 海拔校正因子 (基于Stone 2000模型)
function calculateElevationFactor(elevation, latitude) {
    const h = calculateAtmosphericPressure(elevation);
    const z = 1033 - h;
    if (z <= 0) return 1.0;

    const Rc = 14.9 * Math.pow(Math.cos(Math.abs(latitude)*Math.PI/180), 4);
    const alpha = 10.275;
    const k = 0.9615;
    
    // 第一项计算
    const term1 = (1.0177e-2 / (1 + Math.exp(-alpha*Math.pow(Rc, -k)))) * z;

    // 第二项多项式计算
    const coefficients = [
        8.5236e-6, -6.3670e-7, -7.0814e-9,
        -9.9182e-9, 9.9250e-10, 2.4925e-11,
        3.8615e-12, -4.8194e-13, -1.5371e-14
    ];
    
    const term2 = (coefficients[0] + coefficients[1]*Rc + coefficients[2]*Rc**2) * (1033**2 - h**2)/2;
    const term3 = (coefficients[3] + coefficients[4]*Rc + coefficients[5]*Rc**2) * (1033**3 - h**3)/3;
    const term4 = (coefficients[6] + coefficients[7]*Rc + coefficients[8]*Rc**2) * (1033**4 - h**4)/4;

    return Math.exp(z/(1 * (term1 + term2 + term3 + term4));
}

// 纬度校正因子
function calculateLatitudeFactor(latitude) {
    const Rc = 14.9 * Math.pow(Math.cos(Math.abs(latitude)*Math.PI/180), 4);
    return 1 - Math.exp(-10.275 * Math.pow(Rc, -0.9615));
}

// 深度衰减校正
function calculateDepthFactor(depth, density) {
    return Math.exp(-(depth * density)/150);
}

// 暴露年龄计算（稳态模型）
function calculateExposureAge(concentration, productionRate, decayConstant) {
    if (productionRate <= 0 || decayConstant <= 0) return null;
    const ratio = (concentration * decayConstant) / productionRate;
    if (ratio >= 1) return Infinity;  // 达到饱和状态
    return -Math.log(1 - ratio) / decayConstant;
}

// 侵蚀速率计算（双核素法）
function calculateErosionRate(be10Data, al26Data) {
    const L = 150; // 衰减长度 (g/cm²)
    const ratio = (be10Data.N * al26Data.P) / (al26Data.N * be10Data.P);
    if (ratio <= 1) return Infinity; // 无侵蚀情况
    return (al26Data.lambda - ratio * be10Data.lambda) / ((ratio - 1)/L);
}

function calculateAll() {
    // 重置显示
    document.getElementById('results').style.display = 'none';
    document.getElementById('error').style.display = 'none';

    // 验证输入参数
    const baseParams = {
        latitude: validateInput('latitude', { min: -90, max: 90 }),
        elevation: validateInput('elevation', { min: 0 }),
        depth: validateInput('depth', { min: 0 }),
        density: validateInput('density', { min: 1.0, max: 3.5 }) || 2.7
    };

    // 验证样品参数
    const sampleParams = {
        be10: validateInput('be10', { min: 0 }),
        al26: validateInput('al26', { min: 0 })
    };

    // 错误处理
    if (Object.values(baseParams).some(v => v === null)) {
        showError("请检查红色标记的输入参数");
        return;
    }

    // 计算校正因子
    const correctionFactors = {
        elevation: calculateElevationFactor(baseParams.elevation, baseParams.latitude),
        latitude: calculateLatitudeFactor(baseParams.latitude),
        depth: calculateDepthFactor(baseParams.depth, baseParams.density)
    };

    // 计算各核素产率
    const productionRates = {};
    Object.entries(NUCLIDE_PARAMS).forEach(([name, param]) => {
        productionRates[name] = param.P0 * correctionFactors.elevation 
                               * correctionFactors.latitude * correctionFactors.depth;
    });

    // 显示计算结果
    showResults(productionRates, sampleParams, correctionFactors);
}

function showResults(productionRates, sampleParams, factors) {
    const results = document.getElementById('results');
    results.style.display = 'block';

    // 显示产率结果
    document.getElementById('production-details').innerHTML = Object.entries(productionRates)
        .map(([name, rate]) => `<p>${name}: <strong>${rate.toFixed(2)} atoms/g/yr</strong></p>`)
        .join('');

    // 显示暴露年龄
    let ageContent = '';
    if (sampleParams.be10 !== null) {
        const ageBe = calculateExposureAge(
            sampleParams.be10,
            productionRates['¹⁰Be'],
            NUCLIDE_PARAMS['¹⁰Be'].lambda
        );
        ageContent += `<p>¹⁰Be暴露年龄: ${formatAge(ageBe)}</p>`;
    }
    if (sampleParams.al26 !== null) {
        const ageAl = calculateExposureAge(
            sampleParams.al26,
            productionRates['²⁶Al'],
            NUCLIDE_PARAMS['²⁶Al'].lambda
        );
        ageContent += `<p>²⁶Al暴露年龄: ${formatAge(ageAl)}</p>`;
    }
    document.getElementById('age-details').innerHTML = ageContent || "<p>未提供浓度数据</p>";

    // 显示侵蚀速率
    if (sampleParams.be10 !== null && sampleParams.al26 !== null) {
        const epsilon = calculateErosionRate(
            {
                N: sampleParams.be10,
                P: productionRates['¹⁰Be'],
                lambda: NUCLIDE_PARAMS['¹⁰Be'].lambda
            },
            {
                N: sampleParams.al26,
                P: productionRates['²⁶Al'],
                lambda: NUCLIDE_PARAMS['²⁶Al'].lambda
            }
        );
        
        document.getElementById('erosion-details').innerHTML = `
            <p>侵蚀速率: ${formatErosionRate(epsilon)}</p>
            ${epsilon < 0 ? '<p class="error">警告：负值可能表示模型不适用</p>' : ''}
        `;
    }
}

// 辅助格式化函数
function formatAge(years) {
    if (years === Infinity) return "＞饱和年龄";
    if (years > 1e6) return `${(years/1e6).toFixed(2)} 百万年`;
    if (years > 1e3) return `${(years/1e3).toFixed(2)} 千年`;
    return `${years.toFixed(0)} 年`;
}

function formatErosionRate(rate) {
    if (rate === Infinity) return "＜检测限";
    return `${rate >= 0 ? '' : '-'}${Math.abs(rate).toExponential(2)} cm/yr`;
}

function showError(message) {
    const errorEl = document.getElementById('error');
    errorEl.innerHTML = message;
    errorEl.style.display = 'block';
}
</script>
</body>
</html><!DOCTYPE html>
<html>
<head>
    <title>宇宙成因核素产率与暴露年龄计算器</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            max-width: 700px;
        }
        .input-group { 
            margin: 15px 0; 
        }
        label {
            display: inline-block;
            width: 120px;
        }
        input, select { 
            width: 160px;
            padding: 6px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .result { 
            margin-top: 20px; 
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        button { 
            padding: 10px 25px;
            background-color: #2196F3;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 15px;
            font-size: 16px;
        }
        button:hover {
            background-color: #0b7dda;
        }
        .error { 
            color: red; 
            margin: 15px 0;
            padding: 10px;
            background-color: #ffeeee;
            border-radius: 4px;
        }
        .debug-info {
            margin-top: 20px;
            padding: 10px;
            background-color: #f0f0f0;
            border-radius: 4px;
            font-size: 14px;
        }
        h2 {
            color: #333;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        .tabs {
            display: flex;
            margin-bottom: 20px;
        }
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background-color: #eee;
            margin-right: 5px;
            border-radius: 4px 4px 0 0;
        }
        .tab.active {
            background-color: #2196F3;
            color: white;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <h2>宇宙成因核素分析计算器</h2>
    
    <div class="tabs">
        <div class="tab active" onclick="switchTab('production')">产率计算</div>
        <div class="tab" onclick="switchTab('age')">暴露年龄</div>
        <div class="tab" onclick="switchTab('erosion')">侵蚀速率</div>
    </div>
    
    <!-- 产率计算部分 -->
    <div id="production-tab" class="tab-content active">
        <div class="input-group">
            <label for="latitude">纬度（度）:</label>
            <input type="number" id="latitude" min="-90" max="90" step="0.0001">
        </div>
        <div class="input-group">
            <label for="elevation">海拔（米）:</label>
            <input type="number" id="elevation" min="0" step="1">
        </div>
        <div class="input-group">
            <label for="depth">深度（厘米）:</label>
            <input type="number" id="depth" min="0" step="0.1">
        </div>
        
        <button onclick="calculateProduction()">计算产率</button>
        <div id="error" class="error" style="display: none;"></div>
        <div id="results" class="result" style="display: none;"></div>
    </div>
    
    <!-- 暴露年龄计算部分 -->
    <div id="age-tab" class="tab-content">
        <div class="input-group">
            <label for="nuclide-age">核素:</label>
            <select id="nuclide-age">
                <option value="10Be">¹⁰Be</option>
                <option value="26Al">²⁶Al</option>
            </select>
        </div>
        <div class="input-group">
            <label for="concentration">浓度(atoms/g):</label>
            <input type="number" id="concentration" min="0" step="1e4">
        </div>
        <div class="input-group">
            <label for="erosion-rate-age">侵蚀速率(cm/kyr):</label>
            <input type="number" id="erosion-rate-age" value="0" min="0" step="0.1">
        </div>
        <div class="input-group">
            <label for="latitude-age">纬度（度）:</label>
            <input type="number" id="latitude-age" min="-90" max="90" step="0.0001">
        </div>
        <div class="input-group">
            <label for="elevation-age">海拔（米）:</label>
            <input type="number" id="elevation-age" min="0" step="1">
        </div>
        <div class="input-group">
            <label for="depth-age">深度（厘米）:</label>
            <input type="number" id="depth-age" min="0" step="0.1">
        </div>
        
        <button onclick="calculateAge()">计算暴露年龄</button>
        <div id="error-age" class="error" style="display: none;"></div>
        <div id="results-age" class="result" style="display: none;"></div>
    </div>
    
    <!-- 侵蚀速率计算部分 -->
    <div id="erosion-tab" class="tab-content">
        <div class="input-group">
            <label for="nuclide1">核素1:</label>
            <select id="nuclide1">
                <option value="10Be">¹⁰Be</option>
                <option value="26Al">²⁶Al</option>
            </select>
        </div>
        <div class="input-group">
            <label for="conc1">浓度1(atoms/g):</label>
            <input type="number" id="conc1" min="0" step="1e4">
        </div>
        <div class="input-group">
            <label for="nuclide2">核素2:</label>
            <select id="nuclide2">
                <option value="26Al">²⁶Al</option>
                <option value="10Be">¹⁰Be</option>
            </select>
        </div>
        <div class="input-group">
            <label for="conc2">浓度2(atoms/g):</label>
            <input type="number" id="conc2" min="0" step="1e4">
        </div>
        <div class="input-group">
            <label for="latitude-erosion">纬度（度）:</label>
            <input type="number" id="latitude-erosion" min="-90" max="90" step="0.0001">
        </div>
        <div class="input-group">
            <label for="elevation-erosion">海拔（米）:</label>
            <input type="number" id="elevation-erosion" min="0" step="1">
        </div>
        <div class="input-group">
            <label for="depth-erosion">深度（厘米）:</label>
            <input type="number" id="depth-erosion" min="0" step="0.1">
        </div>
        
        <button onclick="calculateErosion()">计算侵蚀速率</button>
        <div id="error-erosion" class="error" style="display: none;"></div>
        <div id="results-erosion" class="result" style="display: none;"></div>
    </div>

    <script>
        // 标称产率（SLHL）
        const P0 = {
            '10Be': 6,    // atoms/g/yr
            '26Al': 36.8,
            '14C': 20,
            '3He': 124,
            '21Ne': 21,
            '36Cl': 54
        };
        
        // 衰变常数 (yr⁻¹)
        const decayConstants = {
            '10Be': 4.99e-7,
            '26Al': 9.83e-7
        };
        
        // 衰减长度 (g/cm²)
        const ATTENUATION_LENGTH = 150;
        // 岩石密度 (g/cm³)
        const ROCK_DENSITY = 2.7;

        // 标签切换
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            document.querySelector(`.tab[onclick="switchTab('${tabName}')"]`).classList.add('active');
            document.getElementById(`${tabName}-tab`).classList.add('active');
        }

        // 输入验证
        function getInputValue(id) {
            const input = document.getElementById(id);
            const value = parseFloat(input.value);
            if (isNaN(value)) {
                input.style.border = "2px solid red";
                return null;
            }
            input.style.border = "1px solid #ccc";
            return value;
        }

        // 精确气压计算
        function calculateAirPressure(elevation) {
            const pressure_hPa = 1013 * Math.pow(1 - elevation / 44330, 5.255);
            return pressure_hPa * (1033 / 1013); // 转换为 g/cm²
        }

        // 海拔校正因子
        function elevationCorrection(elevation, lat) {
            const h = calculateAirPressure(elevation);
            const z = 1033 - h;

            if (z <= 0) return 1.0;
            
            const params = {
                n: 1.0177e-2,
                k: 0.9615,
                alpha: 10.275,
                a: [
                    8.5236e-6, -6.3670e-7, -7.0814e-9,
                    -9.9182e-9, 9.9250e-10, 2.4925e-11,
                    3.8615e-12, -4.8194e-13, -1.5371e-14
                ]
            };
            
            const latRad = Math.abs(lat) * Math.PI / 180;
            const R_C = 14.9 * Math.pow(Math.cos(latRad), 4);
            
            // Term 1
            const expArg = -params.alpha * Math.pow(R_C, -params.k);
            const denominator = 1 + Math.exp(expArg);
            const term1 = (params.n / denominator) * z;

            // Term 2
            const term2 = (
                (params.a[0] + params.a[1] * R_C + params.a[2] * Math.pow(R_C, 2)) * 
                (Math.pow(1033, 2) - Math.pow(h, 2))) / 2;

            // Term 3
            const term3 = (
                (params.a[3] + params.a[4] * R_C + params.a[5] * Math.pow(R_C, 2)) * 
                (Math.pow(1033, 3) - Math.pow(h, 3))) / 3;

            // Term 4
            const term4 = (
                (params.a[6] + params.a[7] * R_C + params.a[8] * Math.pow(R_C, 2)) * 
                (Math.pow(1033, 4) - Math.pow(h, 4))) / 4;

            const c = term1 + term2 + term3 + term4;
            if (c <= 0 || c > 1e6) return 1.0;

            return Math.exp(z/150);
        }

        // 纬度校正因子
        function latitudeCorrection(lat) {
            const alpha = 10.275;
            const k = 0.9615;
            const latRad = Math.abs(lat) * Math.PI / 180;
            const R_C = 14.9 * Math.pow(Math.cos(latRad), 4);
            return R_C <= 0 ? 1.0 : 1 - Math.exp(-alpha * Math.pow(R_C, -k));
        }

        // 深度衰减
        function depthAttenuation(depth) {
            return Math.exp(-(depth * ROCK_DENSITY) / ATTENUATION_LENGTH);
        }
        
        // 计算产率
        function calculateProductionRate(elevation, lat, depth) {
            const elevCorr = elevationCorrection(elevation, lat);
            const latCorr = latitudeCorrection(lat);
            const depthCorr = depthAttenuation(depth);
            
            const rates = {};
            for (const [nuclide, base] of Object.entries(P0)) {
                rates[nuclide] = base * elevCorr * latCorr * depthCorr;
            }
            
            return {
                rates: rates,
                elevCorr: elevCorr,
                latCorr: latCorr,
                depthCorr: depthCorr
            };
        }

        // 计算产率（主函数）
        function calculateProduction() {
            // 重置状态
            document.getElementById('error').style.display = 'none';
            document.getElementById('results').style.display = 'none';
            document.querySelectorAll('input').forEach(i => i.style.border = "1px solid #ccc");

            // 获取输入
            const lat = getInputValue('latitude');
            const elev = getInputValue('elevation');
            const depth = getInputValue('depth');

            // 输入验证
            const errorEl = document.getElementById('error');
            if (lat === null || elev === null || depth === null) {
                errorEl.innerHTML = "错误：请填写所有输入项（必须为数字）";
                errorEl.style.display = 'block';
                return;
            }
            
            if (Math.abs(lat) > 90) {
                errorEl.innerHTML = "错误：纬度必须在-90到90度之间";
                errorEl.style.display = 'block';
                return;
            }

            if (elev < 0) {
                errorEl.innerHTML = "错误：海拔不能为负数";
                errorEl.style.display = 'block';
                return;
            }

            if (depth < 0) {
                errorEl.innerHTML = "错误：深度不能为负数";
                errorEl.style.display = 'block';
                return;
            }

            // 计算产率
            const production = calculateProductionRate(elev, lat, depth);

            // 生成结果
            let results = "<h3>校正后产率（atoms/g/yr）:</h3>";
            for (const [nuclide, rate] of Object.entries(production.rates)) {
                const displayName = nuclide === '10Be' ? '¹⁰Be' : 
                                  nuclide === '26Al' ? '²⁶Al' : 
                                  nuclide === '14C' ? '¹⁴C' : 
                                  nuclide === '3He' ? '³He' : 
                                  nuclide === '21Ne' ? '²¹Ne' : '³⁶Cl';
                results += `<div>${displayName}: <b>${rate.toFixed(2)}</b></div>`;
            }

            // 显示调试信息
            results += `
                <div class="debug-info">
                    <h4>调试信息：</h4>
                    <div>海拔校正因子 = ${production.elevCorr.toFixed(4)}</div>
                    <div>纬度校正因子 = ${production.latCorr.toFixed(4)}</div>
                    <div>深度衰减因子 = ${production.depthCorr.toFixed(4)}</div>
                </div>
            `;

            const resultsEl = document.getElementById('results');
            resultsEl.innerHTML = results;
            resultsEl.style.display = 'block';
        }
        
        // 计算暴露年龄
        function calculateAge() {
            // 重置状态
            document.getElementById('error-age').style.display = 'none';
            document.getElementById('results-age').style.display = 'none';
            document.querySelectorAll('#age-tab input').forEach(i => i.style.border = "1px solid #ccc");

            // 获取输入
            const nuclide = document.getElementById('nuclide-age').value;
            const concentration = getInputValue('concentration');
            const erosionRate = getInputValue('erosion-rate-age');
            const lat = getInputValue('latitude-age');
            const elev = getInputValue('elevation-age');
            const depth = getInputValue('depth-age');

            // 输入验证
            const errorEl = document.getElementById('error-age');
            if (concentration === null || erosionRate === null || lat === null || elev === null || depth === null) {
                errorEl.innerHTML = "错误：请填写所有输入项（必须为数字）";
                errorEl.style.display = 'block';
                return;
            }
            
            if (Math.abs(lat) > 90) {
                errorEl.innerHTML = "错误：纬度必须在-90到90度之间";
                errorEl.style.display = 'block';
                return;
            }

            if (elev < 0) {
                errorEl.innerHTML = "错误：海拔不能为负数";
                errorEl.style.display = 'block';
                return;
            }

            if (depth < 0) {
                errorEl.innerHTML = "错误：深度不能为负数";
                errorEl.style.display = 'block';
                return;
            }

            if (concentration <= 0) {
                errorEl.innerHTML = "错误：浓度必须为正数";
                errorEl.style.display = 'block';
                return;
            }

            if (erosionRate < 0) {
                errorEl.innerHTML = "错误：侵蚀速率不能为负数";
                errorEl.style.display = 'block';
                return;
            }

            // 计算产率
            const production = calculateProductionRate(elev, lat, depth);
            const P = production.rates[nuclide];
            const lambda = decayConstants[nuclide];
            
            // 侵蚀速率转换为 g/cm²/yr
            const epsilon = erosionRate * ROCK_DENSITY / 1000; // cm/kyr -> cm/yr -> g/cm²/yr
            
            // 计算暴露年龄
            let age;
            if (epsilon === 0) {
                // 无侵蚀情况
                age = concentration / P * (1 - Math.exp(-lambda * 1e6)) / (1 - Math.exp(-lambda * 1e6));
                age = concentration / (P + lambda * concentration);
            } else {
                // 有侵蚀情况
                const effectiveAttenuationLength = ATTENUATION_LENGTH / (ROCK_DENSITY * epsilon);
                age = Math.log(1 + (concentration * lambda * effectiveAttenuationLength / P)) / lambda;
            }
            
            // 生成结果
            const displayName = nuclide === '10Be' ? '¹⁰Be' : '²⁶Al';
            let results = `<h3>${displayName}暴露年龄计算结果:</h3>`;
            results += `<div>浓度: <b>${concentration.toExponential(2)} atoms/g</b></div>`;
            results += `<div>产率: <b>${P.toFixed(2)} atoms/g/yr</b></div>`;
            results += `<div>侵蚀速率: <b>${erosionRate.toFixed(2)} cm/kyr</b></div>`;
            results += `<div style="font-size: 1.2em; margin-top: 10px;">暴露年龄: <b>${(age/1000).toFixed(2)} kyr</b></div>`;
            
            // 显示调试信息
            results += `
                <div class="debug-info">
                    <h4>调试信息：</h4>
                    <div>海拔校正因子 = ${production.elevCorr.toFixed(4)}</div>
                    <div>纬度校正因子 = ${production.latCorr.toFixed(4)}</div>
                    <div>深度衰减因子 = ${production.depthCorr.toFixed(4)}</div>
                    <div>衰变常数 = ${lambda.toExponential(2)} yr⁻¹</div>
                </div>
            `;

            const resultsEl = document.getElementById('results-age');
            resultsEl.innerHTML = results;
            resultsEl.style.display = 'block';
        }
        
        // 计算侵蚀速率（基于双核素法）
        function calculateErosion() {
            // 重置状态
            document.getElementById('error-erosion').style.display = 'none';
            document.getElementById('results-erosion').style.display = 'none';
            document.querySelectorAll('#erosion-tab input').forEach(i => i.style.border = "1px solid #ccc");

            // 获取输入
            const nuclide1 = document.getElementById('nuclide1').value;
            const conc1 = getInputValue('conc1');
            const nuclide2 = document.getElementById('nuclide2').value;
            const conc2 = getInputValue('conc2');
            const lat = getInputValue('latitude-erosion');
            const elev = getInputValue('elevation-erosion');
            const depth = getInputValue('depth-erosion');

            // 输入验证
            const errorEl = document.getElementById('error-erosion');
            if (conc1 === null || conc2 === null || lat === null || elev === null || depth === null) {
                errorEl.innerHTML = "错误：请填写所有输入项（必须为数字）";
                errorEl.style.display = 'block';
                return;
            }
            
            if (nuclide1 === nuclide2) {
                errorEl.innerHTML = "错误：请选择两种不同的核素";
                errorEl.style.display = 'block';
                return;
            }
            
            if (Math.abs(lat) > 90) {
                errorEl.innerHTML = "错误：纬度必须在-90到90度之间";
                errorEl.style.display = 'block';
                return;
            }

            if (elev < 0) {
                errorEl.innerHTML = "错误：海拔不能为负数";
                errorEl.style.display = 'block';
                return;
            }

            if (depth < 0) {
                errorEl.innerHTML = "错误：深度不能为负数";
                errorEl.style.display = 'block';
                return;
            }

            if (conc1 <= 0 || conc2 <= 0) {
                errorEl.innerHTML = "错误：浓度必须为正数";
                errorEl.style.display = 'block';
                return;
            }

            // 计算产率
            const production = calculateProductionRate(elev, lat, depth);
            const P1 = production.rates[nuclide1];
            const P2 = production.rates[nuclide2];
            const lambda1 = decayConstants[nuclide1];
            const lambda2 = decayConstants[nuclide2];
            
            // 计算侵蚀速率（基于双核素比值法）
            // 这里使用简化的近似解，实际应用中可能需要更复杂的数值解法
            const ratio = (conc1 / P1) / (conc2 / P2);
            let epsilon = 0;
            
            if (nuclide1 === '10Be' && nuclide2 === '26Al') {
                // 10Be-26Al法
                const effectiveLambda = lambda2 - lambda1;
                epsilon = (lambda2 - lambda1 * ratio) / (ROCK_DENSITY / ATTENUATION_LENGTH * (ratio - 1));
            } else if (nuclide1 === '26Al' && nuclide2 === '10Be') {
                // 26Al-10Be法
                const effectiveLambda = lambda1 - lambda2;
                epsilon = (lambda1 - lambda2 / ratio) / (ROCK_DENSITY / ATTENUATION_LENGTH * (1/ratio - 1));
            }
            
            // 转换为 cm/kyr
            epsilon = epsilon * 1000 / ROCK_DENSITY;
            
            // 生成结果
            const displayName1 = nuclide1 === '10Be' ? '¹⁰Be' : '²⁶Al';
            const displayName2 = nuclide2 === '10Be' ? '¹⁰Be' : '²⁶Al';
            
            let results = `<h3>${displayName1}-${displayName2}侵蚀速率计算结果:</h3>`;
            results += `<div>${displayName1}浓度: <b>${conc1.toExponential(2)} atoms/g</b></div>`;
            results += `<div>${displayName2}浓度: <b>${conc2.toExponential(2)} atoms/g</b></div>`;
            results += `<div>${displayName1}产率: <b>${P1.toFixed(2)} atoms/g/yr</b></div>`;
            results += `<div>${displayName2}产率: <b>${P2.toFixed(2)} atoms/g/yr</b></div>`;
            results += `<div style="font-size: 1.2em; margin-top: 10px;">侵蚀速率: <b>${epsilon.toFixed(2)} cm/kyr</b></div>`;
            
            // 显示调试信息
            results += `
                <div class="debug-info">
                    <h4>调试信息：</h4>
                    <div>海拔校正因子 = ${production.elevCorr.toFixed(4)}</div>
                    <div>纬度校正因子 = ${production.latCorr.toFixed(4)}</div>
                    <div>深度衰减因子 = ${production.depthCorr.toFixed(4)}</div>
                    <div>${displayName1}衰变常数 = ${lambda1.toExponential(2)} yr⁻¹</div>
                    <div>${displayName2}衰变常数 = ${lambda2.toExponential(2)} yr⁻¹</div>
                </div>
            `;

            const resultsEl = document.getElementById('results-erosion');
            resultsEl.innerHTML = results;
            resultsEl.style.display = 'block';
        }
    </script>
</body>
</html>
  
